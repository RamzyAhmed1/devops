apiVersion: v1
kind: Service
metadata:
  name: vote # Internal service name for the vote component
spec:
  type: ClusterIP
  selector:
    app: vote
  ports:
  - port: 80
    targetPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: result # Internal service name for the result component
spec:
  type: ClusterIP
  selector:
    app: result
  ports:
  - port: 80
    targetPort: 4000 # Exposes port 80 internally but forwards traffic to port 4000
---
# === Key Part ===
# We map "db" to the actual "db-postgresql" service
apiVersion: v1
kind: Service
metadata:
  name: db # The service name that our application expects
spec:
  type: ExternalName
  # This points to the actual PostgreSQL service installed via Helm
  externalName: db-postgresql.default.svc.cluster.local
---
# We map "redis" to the actual "redis-master" service
apiVersion: v1
kind: Service
metadata:
  name: redis # The service name the application uses to reach Redis
spec:
  type: ExternalName
  # This resolves to the real Redis endpoint deployed via Helm
  externalName: redis-master.default.svc.cluster.local
