apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: db-access-policy # Policy name
spec:
  podSelector: # Apply this policy to...
    matchLabels:
      app.kubernetes.io/name: postgresql # PostgreSQL pods deployed via Helm
  policyTypes:
  - Ingress # Weâ€™re restricting incoming traffic
  ingress:
  - from:
    - podSelector: # Allow traffic coming from...
        matchLabels:
          app: result # Any pod labeled "app: result"
    - podSelector: # Also allow traffic from...
        matchLabels:
          app: worker # Any pod labeled "app: worker"
    ports:
    - protocol: TCP
      port: 5432 # Only permit connections on port 5432
